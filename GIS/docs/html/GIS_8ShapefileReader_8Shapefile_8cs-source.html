<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GIS: GIS.ShapefileReader.Shapefile.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>GIS.ShapefileReader.Shapefile.cs</h1><a href="GIS_8ShapefileReader_8Shapefile_8cs.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">//Shapefile.cs</span>
00003 <span class="comment">//</span>
00004 
00024 
00025 <span class="keyword">using</span> System;
00026 <span class="keyword">using</span> System.IO;
00027 <span class="keyword">using</span> System.Drawing;
00028 <span class="keyword">using</span> System.Drawing.Drawing2D;
00029 <span class="keyword">using</span> System.Drawing.Imaging;
00030 <span class="keyword">using</span> System.Windows.Forms;
00031 <span class="keyword">using</span> System.Collections;
00032 <span class="keyword">using</span> System.Threading;
00033 
00034 <span class="keyword">using</span> ShapeDotNet.GIS.DbaseReader;
00035 
00036 <span class="keyword">namespace </span>ShapeDotNet.GIS.ShapefileReader
00037 {
00038     
00039     
00040     
<a name="l00047"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html">00047</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html">Shapefile</a> : <a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1ShapeIndex.html">ShapeIndex</a>, <a class="code" href="interfaceShapeDotNet_1_1GIS_1_1IMapLayer.html">IMapLayer</a> 
00048     {
<a name="l00049"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep0">00049</a>         <span class="keyword">protected</span> Dbase _db;
<a name="l00050"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep1">00050</a>         <span class="keyword">protected</span> Pen _pen;
<a name="l00051"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep2">00051</a>         <span class="keyword">protected</span> SolidBrush _brush;
<a name="l00052"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep3">00052</a>         <span class="keyword">protected</span> <span class="keywordtype">bool</span> _labels;
<a name="l00053"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep4">00053</a>         <span class="keyword">protected</span> <span class="keywordtype">int</span> _labelSourceField;
<a name="l00054"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep5">00054</a>         <span class="keyword">protected</span> Color _labelForeColor;
<a name="l00055"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep6">00055</a>         <span class="keyword">protected</span> Color _labelFillColor;
<a name="l00056"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep7">00056</a>         <span class="keyword">protected</span> Font _labelFont;
<a name="l00057"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep8">00057</a>         <span class="keyword">protected</span> <span class="keywordtype">bool</span> _labelBackground;
<a name="l00058"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep9">00058</a>         <span class="keyword">protected</span> <span class="keywordtype">int</span> _highlightedFeature;
<a name="l00059"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilep10">00059</a>         <span class="keyword">protected</span> string _layerName;
00060         
00061         <span class="keyword">private</span> <span class="keyword">const</span> <span class="keywordtype">int</span> NUM_THREADS = 8;
00062         <span class="keyword">private</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1RenderThread.html">RenderThread</a>[] drawThreads;
00063         <span class="keyword">private</span> Thread[] threads;
00064         <span class="keyword">private</span> <span class="keywordtype">int</span> threadBoundary;
00065         
00066         
00067         
<a name="l00075"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilea0">00075</a>         <span class="keyword">public</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html">Shapefile</a>( string filename, <a class="code" href="classShapeDotNet_1_1GIS_1_1MapMetrics.html">MapMetrics</a> metrics ) : base( filename, metrics )
00076         {
00077             _db                 = <span class="keyword">new</span> Dbase( filename );
00078             _pen                = <span class="keyword">new</span> Pen( Color.Black  );
00079             _brush              = <span class="keyword">new</span> SolidBrush( Color.Tan );
00080             _labelSourceField   = 0;
00081             _labelForeColor     = Color.Black;
00082             _labelFillColor     = Color.White;
00083             _labelFont          = <span class="keyword">new</span> Font( <span class="stringliteral">"Tahoma"</span>, 8 );
00084             _labelBackground    = <span class="keyword">true</span>;
00085             _highlightedFeature = -1;
00086             _layerName          = _Filename;
00087 
00088             drawThreads         = <span class="keyword">new</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1RenderThread.html">RenderThread</a>[ NUM_THREADS ];
00089             threads             = <span class="keyword">new</span> Thread[ NUM_THREADS ];
00090             threadBoundary      = _features.Length / NUM_THREADS; <span class="comment">// integer division, I know.</span>
00091         }
00092 
00093         
00094         
<a name="l00100"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilea1">00100</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Draw()
00101         {
00102             GenerateDrawList();
00103                             
00104             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> a=0; a&lt;NUM_THREADS; ++a )
00105             {
00106                 <span class="keywordflow">if</span> ( a == NUM_THREADS - 1 )
00107                 {
00108                     drawThreads[ a ] = <span class="keyword">new</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1RenderThread.html">RenderThread</a>( _mapMetrics, _features,
00109                         _ShapeType, a * threadBoundary, _features.Length, _pen, _brush );
00110                 }
00111                 <span class="keywordflow">else</span>
00112                 {
00113                     drawThreads[ a ] = <span class="keyword">new</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1RenderThread.html">RenderThread</a>( _mapMetrics, _features, 
00114                         _ShapeType, a * threadBoundary, (a + 1) * threadBoundary, _pen, _brush );
00115                 }
00116 
00117                 threads[ a ] = <span class="keyword">new</span> Thread( <span class="keyword">new</span> ThreadStart( drawThreads[a].Start ) );
00118                 threads[ a ].Start();
00119             }
00120 
00121             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> b=0; b&lt;NUM_THREADS; ++b )
00122             {
00123                 threads[b].Join();
00124             }
00125 
00126             <span class="comment">// if a feature has been highlighted with a query</span>
00127             
00128             <span class="keywordflow">if</span> ( _highlightedFeature != -1 )
00129             {
00130                 <span class="keyword">this</span>.Highlight( _highlightedFeature, SystemColors.Highlight );
00131             }
00132         }
00133 
00134 
00135 
<a name="l00141"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilea2">00141</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> DrawLabels()
00142         {
00143             Graphics gr = Graphics.FromImage( _mapMetrics.Canvas );
00144             gr.TextRenderingHint = System.Drawing.Text.TextRenderingHint.AntiAliasGridFit;
00145             ArrayList labelList = <span class="keyword">new</span> ArrayList();
00146 
00147             
00148             <span class="keywordflow">if</span> ( _ShapeType == <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1ShapefileReader.html#a5">ShapeType</a>.Point )
00149             {                   
00150                 <span class="keywordtype">int</span> posx;
00151                 <span class="keywordtype">int</span> posy;
00152                 <span class="keywordtype">bool</span> drawLabel;
00153                 string tempLabel;
00154 
00155                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> a=0; a&lt;_features.Length; a++ )
00156                 {
00157                     <span class="keywordflow">if</span> ( _features[a].IsInViewport == <span class="keyword">false</span> ) <span class="keywordflow">continue</span>;
00158                     
00159                     drawLabel = <span class="keyword">true</span>;
00160                     tempLabel = _db[a][_labelSourceField];
00161                     tempLabel.Trim();
00162 
00163                     SizeF fontSize = gr.MeasureString( tempLabel, _labelFont );
00164                     
00165                     posx = (<span class="keywordtype">int</span>)((_features[a][0][0].X + (_pen.Width /2)) - ( fontSize.Width / 2 ));
00166                     posy = (<span class="keywordtype">int</span>)(_features[a][0][0].Y - ( fontSize.Height ));
00167 
00168                     Rectangle labelArea = <span class="keyword">new</span> Rectangle( posx, posy,
00169                         (<span class="keywordtype">int</span>) fontSize.Width, (<span class="keywordtype">int</span>) fontSize.Height );
00170 
00171                     gr.ResetTransform();
00172                     gr.TranslateTransform( (<span class="keywordtype">float</span>) posx, (<span class="keywordtype">float</span>) posy );
00173 
00174                     labelArea.Inflate( 2, 2 );
00175                     
00176                     foreach ( Rectangle ll in labelList )
00177                     {
00178                         <span class="keywordflow">if</span> ( ll.IntersectsWith( labelArea ) ) drawLabel = <span class="keyword">false</span>;
00179                     }
00180                     
00181                     <span class="keywordflow">if</span> ( drawLabel == <span class="keyword">false</span> ) 
00182                     {
00183                         <span class="keywordflow">continue</span>;
00184                     }
00185                     <span class="keywordflow">else</span>
00186                     {
00187                         labelList.Add( labelArea );
00188                     }
00189 
00190                     <span class="keywordflow">if</span> ( _labelBackground == <span class="keyword">true</span> &amp;&amp; !tempLabel.StartsWith(<span class="stringliteral">" "</span>) )
00191                     {
00192                         gr.FillRectangle( <span class="keyword">new</span> SolidBrush( _labelFillColor ), 0, 0, 
00193                             fontSize.Width, fontSize.Height );
00194                         gr.DrawRectangle( <span class="keyword">new</span> Pen( _labelForeColor, 1f ), 0, 0, 
00195                             fontSize.Width, fontSize.Height );
00196                     }
00197                 
00198                     gr.DrawString( tempLabel, _labelFont, 
00199                         <span class="keyword">new</span> SolidBrush( _labelForeColor ), 0, 0 );
00200                 }
00201             }
00202 
00203 
00204             <span class="keywordflow">if</span> ( _ShapeType == <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1ShapefileReader.html#a5">ShapeType</a>.Polygon ||
00205                   _ShapeType == <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1ShapefileReader.html#a5">ShapeType</a>.Multipoint )
00206             {
00207                 <span class="keywordtype">double</span> centerx;
00208                 <span class="keywordtype">double</span> centery;
00209                 <span class="keywordtype">bool</span> drawLabel;
00210                 string tempLabel;
00211 
00212                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> a=0; a&lt;_features.Length; a++ )
00213                 {
00214                     <span class="keywordflow">if</span> ( _features[a].IsInViewport == <span class="keyword">false</span> ) <span class="keywordflow">continue</span>;
00215                     
00216                     drawLabel = <span class="keyword">true</span>;
00217                     tempLabel = _db[a][_labelSourceField];
00218                     tempLabel.Trim();
00219 
00220                     SizeF fontSize = gr.MeasureString( tempLabel, _labelFont );
00221                 
00222                     centerx = _features[a].LabelAnchor.X;
00223                     centery = _features[a].LabelAnchor.Y;
00224             
00225                     _mapMetrics.World2Pixel( ref centerx, ref centery );
00226 
00227                     centerx = (<span class="keywordtype">int</span>)( centerx - ( fontSize.Width / 2 ));
00228                     centery = (<span class="keywordtype">int</span>)( centery - ( fontSize.Height / 2 ));
00229 
00230                     Rectangle labelArea = <span class="keyword">new</span> Rectangle( (<span class="keywordtype">int</span>)centerx, (<span class="keywordtype">int</span>)centery,
00231                         (<span class="keywordtype">int</span>)fontSize.Width, (<span class="keywordtype">int</span>)fontSize.Height );
00232 
00233                     gr.ResetTransform();
00234                     gr.TranslateTransform( (<span class="keywordtype">float</span>) centerx, (<span class="keywordtype">float</span>) centery );
00235 
00236                     labelArea.Inflate( 2, 2 );
00237 
00238                     foreach ( Rectangle ll in labelList )
00239                     {
00240                         <span class="keywordflow">if</span> ( ll.IntersectsWith( labelArea ) ) drawLabel = <span class="keyword">false</span>;
00241                     }
00242                     
00243                     <span class="keywordflow">if</span> ( drawLabel == <span class="keyword">false</span> ) 
00244                     {
00245                         <span class="keywordflow">continue</span>;
00246                     }
00247                     <span class="keywordflow">else</span>
00248                     {
00249                         labelList.Add( labelArea );
00250                     }
00251 
00252                     <span class="keywordflow">if</span> ( _labelBackground == <span class="keyword">true</span> &amp;&amp; !tempLabel.StartsWith(<span class="stringliteral">" "</span>) )
00253                     {
00254                         gr.FillRectangle( <span class="keyword">new</span> SolidBrush( _labelFillColor ), 0, 0, 
00255                             fontSize.Width, fontSize.Height );
00256                         gr.DrawRectangle( <span class="keyword">new</span> Pen( _labelForeColor, 1f ), 0, 0, 
00257                             fontSize.Width, fontSize.Height );
00258                     }
00259             
00260                     gr.DrawString( tempLabel, _labelFont, 
00261                         <span class="keyword">new</span> SolidBrush( _labelForeColor ), 0, 0 );
00262                 }
00263             }
00264 
00265             
00266             <span class="keywordflow">if</span> ( _ShapeType == <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1ShapefileReader.html#a5">ShapeType</a>.Line )
00267             {
00268                 <span class="keywordtype">double</span> centerx;
00269                 <span class="keywordtype">double</span> centery;
00270                 <span class="keywordtype">bool</span> drawLabel;
00271                 string tempLabel;
00272                 
00273                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> a=0; a&lt;_features.Length; a++ )
00274                 {
00275                     <span class="keywordflow">if</span> ( _features[a].IsInViewport == <span class="keyword">false</span> ) <span class="keywordflow">continue</span>;
00276                     
00277                     drawLabel = <span class="keyword">true</span>;
00278                     tempLabel = _db[a][_labelSourceField];
00279                     tempLabel.Trim();
00280 
00281                     SizeF fontSize = gr.MeasureString( tempLabel, _labelFont );
00282 
00283                     centerx = _features[a].LabelAnchor.X;
00284                     centery = _features[a].LabelAnchor.Y;
00285             
00286                     _mapMetrics.World2Pixel( ref centerx, ref centery );
00287 
00288                     Rectangle labelArea = <span class="keyword">new</span> Rectangle( (<span class="keywordtype">int</span>)(centerx -fontSize.Width / 2), (<span class="keywordtype">int</span>)(centery -fontSize.Width / 2),
00289                         (<span class="keywordtype">int</span>)fontSize.Width, (<span class="keywordtype">int</span>)fontSize.Height );
00290 
00291                     gr.ResetTransform();
00292 
00293                     gr.TranslateTransform( (<span class="keywordtype">float</span>)centerx, (<span class="keywordtype">float</span>)centery );
00294                     gr.RotateTransform( _features[a].FeatureAngle );
00295                     gr.TranslateTransform( -fontSize.Width / 2, fontSize.Height * .20f );
00296                     
00297                     
00298 
00299                     labelArea.Inflate( 10, 20 );
00300                     
00301                     foreach ( Rectangle ll in labelList )
00302                     {
00303                         <span class="keywordflow">if</span> ( labelArea.IntersectsWith( ll ) ) 
00304                         {
00305                             drawLabel = <span class="keyword">false</span>;
00306                         }                           
00307                     }
00308                     
00309                     <span class="keywordflow">if</span> ( drawLabel == <span class="keyword">false</span> ) 
00310                     {
00311                         <span class="keywordflow">continue</span>;
00312                     }
00313                     <span class="keywordflow">else</span>
00314                     {
00315                         labelList.Add( labelArea );
00316                     }
00317 
00318                     <span class="keywordflow">if</span> ( _labelBackground == <span class="keyword">true</span> &amp;&amp; !tempLabel.StartsWith(<span class="stringliteral">" "</span>) )
00319                     {
00320                         gr.FillRectangle( <span class="keyword">new</span> SolidBrush( _labelFillColor ), 0, 0, 
00321                             fontSize.Width, fontSize.Height );
00322                         gr.DrawRectangle( <span class="keyword">new</span> Pen( _labelForeColor, 1f ), 0, 0, 
00323                             fontSize.Width, fontSize.Height );
00324                     }
00325 
00326                     gr.DrawString( tempLabel, _labelFont, 
00327                         <span class="keyword">new</span> SolidBrush( _labelForeColor ), 0, 0 );
00328                 }           
00329             }                
00330                 gr.Dispose();
00331         }
00332 
00333 
00334 
00339         <span class="keyword">private</span> <span class="keywordtype">void</span> GenerateDrawList()
00340         {               
00341             <span class="comment">//If the viewport = extents of the map, we're drawing everything...</span>
00342             <span class="keywordflow">if</span> ( _mapMetrics.Viewport.Xmin == _mapMetrics.Extents.Xmin &amp;&amp;
00343                 _mapMetrics.Viewport.Ymin == _mapMetrics.Extents.Ymin &amp;&amp;
00344                 _mapMetrics.Viewport.Xmax == _mapMetrics.Extents.Xmax &amp;&amp;
00345                 _mapMetrics.Viewport.Ymax == _mapMetrics.Extents.Ymax )
00346             {
00347                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> a=0; a&lt;_FeatureCount; ++a )
00348                 {
00349                     _features[ a ].IsInViewport = <span class="keyword">true</span>;
00350                 }
00351 
00352                 <span class="keywordflow">return</span>;
00353             }
00354             
00355             <span class="keywordflow">if</span> ( _ShapeType == ShapeType.Point )
00356             {
00357                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> a=0; a &lt; _FeatureCount; ++a )
00358                 {
00359                     _features[ a ].IsInViewport = 
00360                         _mapMetrics.Viewport.Contains( _features[ a ].GetPoint( 0, 0 ) );
00361                 }
00362             }
00363             <span class="keywordflow">else</span>
00364             {           
00365                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> a=0; a &lt; _FeatureCount; ++a )
00366                 {
00367                     _features[ a ].IsInViewport = 
00368                         _mapMetrics.Viewport.Intersects( _features[ a ].Extents );
00369                 }
00370             }
00371         }
00372 
00373 
00374         
00380         <span class="keyword">private</span> <span class="keywordtype">void</span> Highlight(<span class="keywordtype">int</span> record_number, Color c)
00381         {
00382             RenderThread drawThread;
00383             Pen tempPen = (Pen) _pen.Clone();
00384             tempPen.Color = <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1DbaseReader.html#a10a5">c</a>;
00385             
00386             <span class="keywordflow">if</span> ( _ShapeType == <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1ShapefileReader.html#a5">ShapeType</a>.Line )
00387             {
00388                 tempPen.Width += 2;
00389                 tempPen.StartCap = LineCap.RoundAnchor;
00390                 tempPen.EndCap = LineCap.RoundAnchor;
00391             }
00392 
00393             HatchBrush tempBrush = <span class="keyword">new</span> HatchBrush( HatchStyle.Percent70, c, Color.Transparent );
00394 
00395             drawThread = <span class="keyword">new</span> RenderThread( _mapMetrics, _features,
00396                 _ShapeType, record_number, record_number + 1, tempPen, tempBrush );
00397 
00398             drawThread.Start();
00399             
00400             tempPen.Dispose();
00401             tempBrush.Dispose();
00402         }
00403 
00404         
00405                 
<a name="l00413"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefilea3">00413</a>         <span class="keyword">public</span> string[] QueryPoint( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
00414         {
00415             <span class="keywordtype">int</span> closestRecord = 0;
00416             <span class="keywordtype">double</span> closestDistance = Double.MaxValue;
00417             <span class="keywordtype">double</span> testDistance = 0;
00418             <span class="keywordtype">double</span> dx = (<span class="keywordtype">double</span>) x;
00419             <span class="keywordtype">double</span> dy = (<span class="keywordtype">double</span>) y;
00420 
00421             _mapMetrics.Pixel2World( ref dx, ref dy );
00422             
00423             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> a=0; a&lt;_FeatureCount; ++a )
00424             {
00425                 <span class="keywordflow">if</span>( !_features[a].IsInViewport ) <span class="keywordflow">continue</span>;
00426                 
00427                 testDistance = _features[a].DistanceFromFeature( <span class="keyword">new</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1PointD.html">PointD</a>( dx, dy ) );
00428                 
00429                 <span class="keywordflow">if</span>( testDistance &lt; closestDistance )
00430                 {
00431                     closestDistance = testDistance;
00432                     closestRecord = a;
00433                 }
00434             }
00435             
00436             _highlightedFeature = closestRecord;
00437             <span class="keywordflow">return</span> _db[ closestRecord ];
00438         }
00439         
00440         
00441                 
00446         <span class="keyword">public</span> string LayerName
<a name="l00447"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile00">00447</a>         {
00448             get
00449             {
00450                 <span class="keywordflow">return</span> _layerName;
00451             }
00452 
00453             set
00454             {
00455                 _layerName = value;
00456             }
00457         }
00458         
00459 
00460 
00464         <span class="keyword">public</span> <span class="keywordtype">bool</span> Labels
<a name="l00465"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile01">00465</a>         {
00466             get
00467             {
00468                 <span class="keywordflow">return</span> _labels;
00469             }
00470 
00471             set
00472             {
00473                 _labels = value;
00474             }
00475         }
00476 
00477 
00481         <span class="keyword">public</span> <span class="keywordtype">bool</span> LabelBackground
<a name="l00482"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile02">00482</a>         {
00483             get
00484             {
00485                 <span class="keywordflow">return</span> _labelBackground;
00486             }
00487 
00488             set
00489             {
00490                 _labelBackground = value;
00491             }
00492         }
00493 
00494 
00498         <span class="keyword">public</span> Font LabelFont
<a name="l00499"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile03">00499</a>         {
00500             get
00501             {
00502                 <span class="keywordflow">return</span> _labelFont;
00503             }
00504             
00505             set
00506             {
00507                 _labelFont = value;
00508             }
00509         }
00510 
00511     
00515         <span class="keyword">public</span> Color LabelForeColor
<a name="l00516"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile04">00516</a>         {
00517             get
00518             {
00519                 <span class="keywordflow">return</span> _labelForeColor;
00520             }
00521 
00522             set
00523             {
00524                 _labelForeColor = value;
00525             }
00526         }
00527 
00528 
00532         <span class="keyword">public</span> Color LabelFillColor
<a name="l00533"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile05">00533</a>         {
00534             get
00535             {
00536                 <span class="keywordflow">return</span> _labelFillColor;
00537             }
00538 
00539             set
00540             {
00541                 _labelFillColor = value;
00542             }
00543         }
00544 
00545 
00549         <span class="keyword">public</span> <span class="keywordtype">int</span> LabelSourceField
<a name="l00550"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile06">00550</a>         {
00551             get
00552             {
00553                 <span class="keywordflow">return</span> _labelSourceField;
00554             }
00555 
00556             set
00557             {
00558                 _labelSourceField = value;
00559             }
00560         }
00561 
00562 
00566         <span class="keyword">public</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1RectangleD.html">RectangleD</a> Extents
<a name="l00567"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile07">00567</a>         {
00568             get
00569             {
00570                 <span class="keywordflow">return</span> _extents;
00571             }
00572         }
00573         
00574 
00578         <span class="keyword">public</span> string[] FieldNames
<a name="l00579"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile08">00579</a>         {
00580             get
00581             {
00582                 <span class="keywordflow">return</span> _db.FieldNames;
00583             }
00584         }
00585 
00586         
00591         <span class="keyword">public</span> <a class="code" href="namespaceShapeDotNet_1_1GIS.html#a6">LayerType</a> DrawingType
<a name="l00592"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile09">00592</a>         {
00593             get
00594             {
00595                 <span class="keywordflow">return</span> <a class="code" href="namespaceShapeDotNet_1_1GIS.html#a6">LayerType</a>.Vector;
00596             }
00597         }
00598         
00599         
00604         <span class="keyword">public</span> <a class="code" href="namespaceShapeDotNet_1_1GIS.html#a7">LayerSubType</a> DrawingSubType
<a name="l00605"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile010">00605</a>         {
00606             get
00607             {
00608                 <span class="keywordflow">return</span> <a class="code" href="namespaceShapeDotNet_1_1GIS.html#a7">LayerSubType</a>.Shapefile;
00609             }
00610         }
00611 
00612         
00616         <span class="keyword">public</span> Pen LayerPen
<a name="l00617"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile011">00617</a>         {
00618             get
00619             {
00620                 <span class="keywordflow">return</span> _pen;
00621             }
00622             set
00623             {
00624                 _pen = value;
00625             }
00626         }
00627         
00628         
00632         <span class="keyword">public</span> SolidBrush LayerBrush
<a name="l00633"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile012">00633</a>         {
00634             get
00635             {
00636                 <span class="keywordflow">return</span> _brush;
00637             }
00638             set
00639             {
00640                 _brush = value;
00641             }
00642         }
00643 
00644         
00648         <span class="keyword">public</span> <span class="keywordtype">int</span> HighlightedFeature
<a name="l00649"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile.html#ShapeDotNet_1_1GIS_1_1ShapefileReader_1_1Shapefile013">00649</a>         {
00650             get
00651             {
00652                 <span class="keywordflow">return</span> _highlightedFeature;
00653             }
00654             set
00655             {
00656                 _highlightedFeature = value;
00657             }
00658         }
00659     }
00660 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Feb 10 17:52:24 2004 for GIS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
