<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GIS: GIS.DbaseReader.Dbase.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>GIS.DbaseReader.Dbase.cs</h1><a href="GIS_8DbaseReader_8Dbase_8cs.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">//Dbase.cs</span>
00003 <span class="comment">//</span>
00004 
00024 
00025 <span class="keyword">using</span> System;
00026 <span class="keyword">using</span> System.IO;
00027 
<a name="l00028"></a><a class="code" href="namespaceShapeDotNet_1_1GIS_1_1DbaseReader.html">00028</a> <span class="keyword">namespace </span>ShapeDotNet.GIS.DbaseReader
00029 {
<a name="l00033"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1DbaseReader_1_1Dbase.html">00033</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classShapeDotNet_1_1GIS_1_1DbaseReader_1_1Dbase.html">Dbase</a> : <a class="code" href="classShapeDotNet_1_1GIS_1_1DbaseReader_1_1DbaseIndex.html">DbaseIndex</a>
00034     {
00035 
<a name="l00036"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1DbaseReader_1_1Dbase.html#ShapeDotNet_1_1GIS_1_1DbaseReader_1_1Dbasea0">00036</a>         <span class="keyword">public</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1DbaseReader_1_1Dbase.html">Dbase</a>( string filename ) : base( filename )
00037         {
00038         }
00039 
00040         ~Dbase()
00041         {
00042         }
00043 
00044         
00050         <span class="keyword">public</span> string[] <span class="keyword">this</span>[ <span class="keywordtype">int</span> index ] 
<a name="l00051"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1DbaseReader_1_1Dbase.html#ShapeDotNet_1_1GIS_1_1DbaseReader_1_1Dbase00">00051</a>         {   
00052             get 
00053             {
00054                 <span class="keywordflow">return</span> GetRecord( index );
00055             }
00056         }
00057 
<a name="l00058"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1DbaseReader_1_1Dbase.html#ShapeDotNet_1_1GIS_1_1DbaseReader_1_1Dbasea1">00058</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Dispose()
00059         {
00060         } 
00061 
00068         <span class="keyword">private</span> string[] GetRecord( <span class="keywordtype">int</span> index )
00069         {
00070             FileStream fs = <span class="keyword">new</span> FileStream( _Filename, FileMode.Open, FileAccess.Read );
00071             BinaryReader br = <span class="keyword">new</span> BinaryReader( fs );
00072             
00073             string[] buffer = <span class="keyword">new</span> string[ _FieldCount ];
00074 
00075             <span class="keywordflow">if</span> ( index &lt; _RecordCount )
00076             {
00077                 fs.Seek( _RecordStart + ( index * _RecordLength ), 0 );
00078             }
00079             <span class="keywordflow">else</span>
00080             {
00081                 <span class="keywordflow">return</span> null;
00082             }
00083 
00084             br.ReadByte();  <span class="comment">// delete flag</span>
00085 
00086             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> a=0; a &lt; _FieldCount; ++a )
00087             {
00088                 <span class="keywordtype">char</span>[] chars;
00089 
00090                 <span class="keywordflow">switch</span>( _FieldTypes[ a ] )
00091                 {
00092                     <span class="keywordflow">case</span> FieldType.C:
00093                     <span class="keywordflow">case</span> FieldType.c:
00094                         <span class="comment">//buffer[ a ] = new string( br.ReadChars( _FieldLengths[ a ] ) );</span>
00095                         chars = <span class="keyword">new</span> <span class="keywordtype">char</span>[_FieldLengths[ a ]];
00096                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _FieldLengths[ a ]; i++) 
00097                         {
00098                             chars[i] = (<span class="keywordtype">char</span>)br.ReadByte();
00099                         }
00100                         buffer[ a ] = <span class="keyword">new</span> string(chars);
00101                         <span class="keywordflow">break</span>;
00102 
00103                     <span class="keywordflow">case</span> FieldType.D:
00104                     <span class="keywordflow">case</span> FieldType.d:
00105                         chars = <span class="keyword">new</span> <span class="keywordtype">char</span>[_FieldLengths[ a ]];
00106                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _FieldLengths[ a ]; i++) 
00107                         {
00108                             chars[i] = (<span class="keywordtype">char</span>)br.ReadByte();
00109                         }
00110                         buffer[ a ] = <span class="keyword">new</span> string(chars);
00111                         <span class="keywordflow">break</span>;
00112 
00113                     <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1DbaseReader.html#a10">FieldType</a>.F:
00114                     <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1DbaseReader.html#a10">FieldType</a>.f:
00115                         chars = <span class="keyword">new</span> <span class="keywordtype">char</span>[_FieldLengths[ a ]];
00116                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _FieldLengths[ a ]; i++) 
00117                         {
00118                             chars[i] = (<span class="keywordtype">char</span>)br.ReadByte();
00119                         }
00120                         buffer[ a ] = <span class="keyword">new</span> string(chars);
00121                         <span class="keywordflow">break</span>;
00122 
00123                     <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1DbaseReader.html#a10">FieldType</a>.L:
00124                     <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1DbaseReader.html#a10">FieldType</a>.l:
00125                         chars = <span class="keyword">new</span> <span class="keywordtype">char</span>[_FieldLengths[ a ]];
00126                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _FieldLengths[ a ]; i++) 
00127                         {
00128                             chars[i] = (<span class="keywordtype">char</span>)br.ReadByte();
00129                         }
00130                         buffer[ a ] = <span class="keyword">new</span> string(chars);
00131                         <span class="keywordflow">break</span>;
00132 
00133                     <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1DbaseReader.html#a10">FieldType</a>.N:
00134                     <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet_1_1GIS_1_1DbaseReader.html#a10">FieldType</a>.n:
00135                         chars = <span class="keyword">new</span> <span class="keywordtype">char</span>[_FieldLengths[ a ]];
00136                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _FieldLengths[ a ]; i++) 
00137                         {
00138                             chars[i] = (<span class="keywordtype">char</span>)br.ReadByte();
00139                         }
00140                         buffer[ a ] = <span class="keyword">new</span> string(chars);
00141                         <span class="keywordflow">break</span>;
00142 
00143                     <span class="keywordflow">default</span>:
00144                         chars = <span class="keyword">new</span> <span class="keywordtype">char</span>[_FieldLengths[ a ]];
00145                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _FieldLengths[ a ]; i++) 
00146                         {
00147                             chars[i] = (<span class="keywordtype">char</span>)br.ReadByte();
00148                         }
00149                         buffer[ a ] = <span class="keyword">new</span> string(chars);
00150                         <span class="keywordflow">break</span>;
00151                 }
00152             }
00153 
00154             br.Close();
00155             fs.Close();
00156 
00157             <span class="keywordflow">return</span> buffer;
00158         }
00159     }
00160 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Feb 10 17:52:24 2004 for GIS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
