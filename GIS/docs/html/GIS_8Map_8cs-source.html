<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GIS: GIS.Map.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>GIS.Map.cs</h1><a href="GIS_8Map_8cs.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">//Map.cs</span>
00003 <span class="comment">//</span>
00004 
00023 
00024 <span class="keyword">using</span> System;
00025 <span class="keyword">using</span> System.Drawing;
00026 
00027 <span class="keyword">namespace </span>ShapeDotNet.GIS
00028 {
<a name="l00035"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html">00035</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html">Map</a> : System.Collections.CollectionBase
00036     {
00037         <a class="code" href="classShapeDotNet_1_1GIS_1_1MapMetrics.html">MapMetrics</a> _mapMetrics = <span class="keyword">new</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1MapMetrics.html">MapMetrics</a>();
00038 
<a name="l00039"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa0">00039</a>         <span class="keyword">public</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html">Map</a>()
00040         {
00041             <span class="comment">//Just a placeholder until the first time Draw() is called.</span>
00042             _mapMetrics.Canvas = <span class="keyword">new</span> Bitmap( 10, 10 );
00043         }
00044 
<a name="l00045"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa1">00045</a>         <span class="keyword">public</span> <a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html">Map</a>( <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height )
00046         {
00047             _mapMetrics.Canvas = <span class="keyword">new</span> Bitmap( width, height );
00048         }
00049 
00050 <span class="comment">/******************  Collection Implementation  ******************************/</span>
00051 
00052 
00057         <span class="keyword">public</span> <a class="code" href="interfaceShapeDotNet_1_1GIS_1_1IMapLayer.html">IMapLayer</a> <span class="keyword">this</span>[ <span class="keywordtype">int</span> index ]  
<a name="l00058"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Map00">00058</a>         {
00059             get  
00060             {
00061                 <span class="keywordflow">return</span>( (<a class="code" href="interfaceShapeDotNet_1_1GIS_1_1IMapLayer.html">IMapLayer</a>) List[index] );
00062             }
00063         }
00064 
<a name="l00070"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa2">00070</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> Add( string filename )  
00071         {
00072             <span class="comment">//TODO: Need file type detection here</span>
00073             <a class="code" href="interfaceShapeDotNet_1_1GIS_1_1IMapLayer.html">IMapLayer</a> ml = <span class="keyword">new</span> ShapefileReader.Shapefile( filename, _mapMetrics );
00074             List.Insert(0, ml); <span class="comment">//always add the new layer to the "top"</span>
00075 
00076             CalculateExtents();
00077 
00078             <span class="keywordflow">return</span> 0;
00079         }
00080 
<a name="l00086"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa3">00086</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Insert( <span class="keywordtype">int</span> index, <a class="code" href="interfaceShapeDotNet_1_1GIS_1_1IMapLayer.html">IMapLayer</a> ml )
00087         {
00088             List.Insert( index, ml );
00089             CalculateExtents();
00090         }
00091         
<a name="l00096"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa4">00096</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Remove( <span class="keywordtype">int</span> index )
00097         {
00098             List.RemoveAt( index );
00099             CalculateExtents();
00100         }
00101 
00102 
00103 
00104 <span class="comment">/******************  End Collection Implementation  **************************/</span>
00105 
00106         
00110         <span class="keyword">private</span> <span class="keywordtype">void</span> CalculateExtents()
00111         {
00112             <span class="keywordflow">if</span> ( List.Count == 0 )
00113             {
00114                 _mapMetrics.Extents.Xmin = 0d;
00115                 _mapMetrics.Extents.Ymin = 0d;
00116                 _mapMetrics.Extents.Xmax = 0d;
00117                 _mapMetrics.Extents.Ymax = 0d;
00118 
00119                 _mapMetrics.Viewport.Xmin = 0d;
00120                 _mapMetrics.Viewport.Ymin = 0d;
00121                 _mapMetrics.Viewport.Xmax = 0d;
00122                 _mapMetrics.Viewport.Ymax = 0d;
00123                 
00124                 _mapMetrics.UpdateMetrics();
00125             }
00126             <span class="keywordflow">else</span>
00127             {
00128             
00129                 _mapMetrics.Extents.Xmin = Double.MaxValue;
00130                 _mapMetrics.Extents.Ymin = Double.MaxValue;
00131                 _mapMetrics.Extents.Xmax = Double.MinValue;
00132                 _mapMetrics.Extents.Ymax = Double.MinValue;
00133 
00134             
00135                 foreach ( IMapLayer layer in List )
00136                 {
00137                     <span class="keywordflow">if</span>  ( layer.Extents.Xmin &lt; _mapMetrics.Extents.Xmin )
00138                     {
00139                         _mapMetrics.Extents.Xmin = layer.Extents.Xmin;
00140                     }
00141                     <span class="keywordflow">if</span>  ( layer.Extents.Ymin &lt; _mapMetrics.Extents.Ymin )
00142                     {
00143                         _mapMetrics.Extents.Ymin = layer.Extents.Ymin;
00144                     }
00145 
00146                     <span class="keywordflow">if</span>  ( layer.Extents.Xmax &gt; _mapMetrics.Extents.Xmax )
00147                     {
00148                         _mapMetrics.Extents.Xmax = layer.Extents.Xmax;
00149                     }
00150                     <span class="keywordflow">if</span>  ( layer.Extents.Ymax &gt; _mapMetrics.Extents.Ymax )
00151                     {
00152                         _mapMetrics.Extents.Ymax = layer.Extents.Ymax;
00153                     }
00154                 }
00155             }
00156 
00157             <span class="comment">// Initialize the viewport if it hasn't been already</span>
00158             <span class="keywordflow">if</span> ( _mapMetrics.Viewport.DeltaX == 0 &amp;&amp;
00159                  _mapMetrics.Viewport.DeltaY == 0 )
00160             {
00161                 _mapMetrics.Extents.FixGeoAspect();
00162 
00163                 _mapMetrics.Viewport.Xmin = _mapMetrics.Extents.Xmin;
00164                 _mapMetrics.Viewport.Ymin = _mapMetrics.Extents.Ymin;
00165                 _mapMetrics.Viewport.Xmax = _mapMetrics.Extents.Xmax;
00166                 _mapMetrics.Viewport.Ymax = _mapMetrics.Extents.Ymax;
00167             }
00168 
00169             _mapMetrics.Extents.FixGeoAspect();
00170         }
00171         
<a name="l00177"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa5">00177</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Center( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
00178         {
00179             <span class="keywordtype">double</span> dx = (<span class="keywordtype">double</span>) x;
00180             <span class="keywordtype">double</span> dy = (<span class="keywordtype">double</span>) y;
00181             
00182             _mapMetrics.Pixel2World( ref dx, ref dy );
00183             Center( dx, dy );
00184         }
00185         
<a name="l00191"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa6">00191</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Center( <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y )
00192         {
00193             <span class="keywordtype">double</span> halfdeltax;
00194             <span class="keywordtype">double</span> halfdeltay;
00195             
00196             halfdeltax = _mapMetrics.Viewport.DeltaX / 2;
00197             halfdeltay = _mapMetrics.Viewport.DeltaY / 2;
00198             
00199             _mapMetrics.Viewport.Xmin = x - halfdeltax;
00200             _mapMetrics.Viewport.Xmax = x + halfdeltax;
00201             
00202             _mapMetrics.Viewport.Ymin = y - halfdeltay;
00203             _mapMetrics.Viewport.Ymax = y + halfdeltay;
00204         }
00205 
<a name="l00214"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa7">00214</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Drag( <span class="keywordtype">int</span> startx, <span class="keywordtype">int</span> starty, <span class="keywordtype">int</span> endx, <span class="keywordtype">int</span> endy )
00215         {
00216             <span class="keywordtype">double</span> dstartx  = (<span class="keywordtype">double</span>) startx;
00217             <span class="keywordtype">double</span> dstarty  = (<span class="keywordtype">double</span>) starty;
00218             <span class="keywordtype">double</span> dendx    = (<span class="keywordtype">double</span>) endx;
00219             <span class="keywordtype">double</span> dendy    = (<span class="keywordtype">double</span>) endy;
00220             <span class="keywordtype">double</span> ddeltax  = 0;
00221             <span class="keywordtype">double</span> ddeltay  = 0;
00222             
00223             _mapMetrics.Pixel2World( ref dstartx, ref dstarty );
00224             _mapMetrics.Pixel2World( ref dendx, ref dendy );
00225             
00226             ddeltax = dstartx - dendx;
00227             ddeltay = dstarty - dendy;
00228             
00229             <span class="keywordflow">if</span> ( ddeltax != 0 || ddeltay != 0 )
00230             {
00231                 _mapMetrics.Viewport.Xmin += ddeltax;
00232                 _mapMetrics.Viewport.Xmax += ddeltax;
00233                 _mapMetrics.Viewport.Ymin += ddeltay;
00234                 _mapMetrics.Viewport.Ymax += ddeltay;
00235             }
00236         }
00237 
<a name="l00246"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa8">00246</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Drag( <span class="keywordtype">double</span> startx, <span class="keywordtype">double</span> starty, <span class="keywordtype">double</span> endx, <span class="keywordtype">double</span> endy )
00247         {
00248             <span class="keywordtype">double</span> ddeltax = 0;
00249             <span class="keywordtype">double</span> ddeltay = 0;
00250             
00251             ddeltax = startx - endx;
00252             ddeltay = starty - endy;
00253 
00254             <span class="keywordflow">if</span> ( ddeltax != 0 || ddeltay != 0 )
00255             {
00256                 _mapMetrics.Viewport.Xmin += ddeltax;
00257                 _mapMetrics.Viewport.Xmax += ddeltax;
00258                 _mapMetrics.Viewport.Ymin += ddeltay;
00259                 _mapMetrics.Viewport.Ymax += ddeltay;
00260             }
00261         }
00262 
<a name="l00267"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa9">00267</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Draw( Bitmap bitmap )
00268         {
00269             lock( <span class="keyword">this</span> )
00270             {
00271                 _mapMetrics.Canvas = bitmap;
00272                 _mapMetrics.UpdateMetrics();
00273             
00274                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> a=List.Count-1; a&gt;-1; --a ) <span class="comment">// draw in reverse order</span>
00275                 {
00276                     <span class="keyword">this</span>[a].Draw();
00277                 }
00278 
00279                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> a=List.Count-1; a&gt;-1; --a ) <span class="comment">// draw in reverse order</span>
00280                 {
00281                     <span class="keywordflow">if</span> ( <span class="keyword">this</span>[a].Labels == <span class="keyword">true</span> )
00282                     {
00283                         <span class="keyword">this</span>[a].DrawLabels();
00284                     }
00285                 }
00286 
00287                 <span class="comment">//ScaleBar sb = new ScaleBar( _mapMetrics );</span>
00288             }
00289         }
00290 
00294         <a class="code" href="classShapeDotNet_1_1GIS_1_1RectangleD.html">RectangleD</a> Extents
00295         {
00296             get
00297             {
00298                 <span class="keywordflow">return</span> _mapMetrics.Extents;
00299             }
00300         }
00301 
<a name="l00309"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa10">00309</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> ZoomArea( <span class="keywordtype">int</span> sx, <span class="keywordtype">int</span> sy, <span class="keywordtype">int</span> ex, <span class="keywordtype">int</span> ey )
00310         {
00311             <span class="keywordtype">double</span> dsx = (<span class="keywordtype">double</span>) sx;
00312             <span class="keywordtype">double</span> dsy = (<span class="keywordtype">double</span>) sy;
00313             <span class="keywordtype">double</span> dex = (<span class="keywordtype">double</span>) ex;
00314             <span class="keywordtype">double</span> dey = (<span class="keywordtype">double</span>) ey;
00315 
00316             <span class="keywordflow">if</span> ( sx != ex || sy != ey ) <span class="comment">// catch a single click</span>
00317             {
00318                 _mapMetrics.Pixel2World( ref dsx, ref dsy );
00319                 _mapMetrics.Pixel2World( ref dex, ref dey );
00320 
00321                 _mapMetrics.Viewport.Xmin = dsx;
00322                 _mapMetrics.Viewport.Xmax = dex;
00323             
00324                 _mapMetrics.Viewport.Ymin = dey;
00325                 _mapMetrics.Viewport.Ymax = dsy;
00326 
00327                 _mapMetrics.Viewport.FixGeoAspect();
00328             }
00329         }
00330 
<a name="l00335"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa11">00335</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> ZoomArea( <a class="code" href="classShapeDotNet_1_1GIS_1_1RectangleD.html">RectangleD</a> rect )
00336         {
00337             _mapMetrics.Viewport = rect;
00338         }
00339 
<a name="l00343"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa12">00343</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> ZoomExtents()
00344         {
00345             _mapMetrics.Viewport.<a class="code" href="classShapeDotNet_1_1GIS_1_1RectangleD.html#ShapeDotNet_1_1GIS_1_1RectangleD06">Xmin</a> = _mapMetrics.Extents.Xmin;
00346             _mapMetrics.Viewport.Ymin = _mapMetrics.Extents.Ymin;
00347             _mapMetrics.Viewport.Xmax = _mapMetrics.Extents.Xmax;
00348             _mapMetrics.Viewport.Ymax = _mapMetrics.Extents.Ymax;
00349         }
00350 
<a name="l00354"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa13">00354</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> ZoomIn()
00355         {
00356             <span class="keywordtype">double</span> quarterdeltax;
00357             <span class="keywordtype">double</span> quarterdeltay;
00358             
00359             quarterdeltax = _mapMetrics.Viewport.DeltaX / 4;
00360             quarterdeltay = _mapMetrics.Viewport.DeltaY / 4;
00361             
00362             _mapMetrics.Viewport.Xmin += quarterdeltax;
00363             _mapMetrics.Viewport.Xmax -= quarterdeltax;
00364             
00365             _mapMetrics.Viewport.Ymin += quarterdeltay;
00366             _mapMetrics.Viewport.Ymax -= quarterdeltay;
00367         }
00368 
<a name="l00374"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa14">00374</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> ZoomIn( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
00375         {
00376             Center( x, y );
00377             ZoomIn();
00378         }
00379 
<a name="l00385"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa15">00385</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> ZoomIn( <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y )
00386         {
00387             Center( x, y );
00388             ZoomIn();
00389         }
00390 
<a name="l00394"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa16">00394</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> ZoomOut()
00395         {
00396             <span class="keywordtype">double</span> thirddeltax;
00397             <span class="keywordtype">double</span> thirddeltay;
00398             
00399             thirddeltax = _mapMetrics.Viewport.DeltaX / 3;
00400             thirddeltay = _mapMetrics.Viewport.DeltaY / 3;
00401             
00402             _mapMetrics.Viewport.Xmin -= thirddeltax;
00403             _mapMetrics.Viewport.Xmax += thirddeltax;
00404             
00405             _mapMetrics.Viewport.Ymin -= thirddeltay;
00406             _mapMetrics.Viewport.Ymax += thirddeltay;
00407             
00408             <span class="comment">//m_LastQueryResult = 0;</span>
00409         }
00410 
<a name="l00416"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa17">00416</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> ZoomOut( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
00417         {
00418             Center( x, y );
00419             ZoomOut();
00420         }
00421 
<a name="l00427"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa18">00427</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> ZoomOut( <span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y )
00428         {
00429             Center( x, y );
00430             ZoomOut();
00431         }
00432 
<a name="l00437"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Mapa19">00437</a>         <span class="keyword">public</span> string[] GetLayerNames()
00438         {
00439             string[] names = <span class="keyword">new</span> string[ List.Count ];
00440 
00441             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> a=0; a&lt;List.Count; ++a )
00442             {
00443                 names[a] = <span class="keyword">this</span>[a].LayerName;
00444             }
00445 
00446             <span class="keywordflow">return</span> names;
00447         }
00448 
00454         <span class="keyword">public</span> MapMetrics Metrics
<a name="l00455"></a><a class="code" href="classShapeDotNet_1_1GIS_1_1Map.html#ShapeDotNet_1_1GIS_1_1Map02">00455</a>         {
00456             get
00457             {
00458                 <span class="keywordflow">return</span> _mapMetrics;
00459             }
00460             set
00461             {
00462                 _mapMetrics = value;
00463             }
00464         }
00465     }
00466 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Feb 10 17:52:24 2004 for GIS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
