<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>MapControl: MapControl.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>MapControl.cs</h1><a href="MapControl_8cs.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">//MapControl.cs</span>
00003 <span class="comment">//</span>
00004 
00024 
00025 <span class="keyword">using</span> System;
00026 <span class="keyword">using</span> System.Collections;
00027 <span class="keyword">using</span> System.ComponentModel;
00028 <span class="keyword">using</span> System.Drawing;
00029 <span class="keyword">using</span> System.Drawing.Drawing2D;
00030 <span class="keyword">using</span> System.Drawing.Imaging;
00031 <span class="keyword">using</span> System.Data;
00032 <span class="keyword">using</span> System.Windows.Forms;
00033 <span class="keyword">using</span> System.Threading;
00034 
00035 <span class="keyword">using</span> ShapeDotNet.GIS;
00036 
<a name="l00037"></a><a class="code" href="namespaceShapeDotNet.html">00037</a> <span class="keyword">namespace </span>ShapeDotNet
00038 {
00039     <span class="keyword">public</span> delegate <span class="keywordtype">void</span> <a class="code" href="namespaceShapeDotNet.html#a6">QueryResultEventHandler</a>( object sender, string[] result );
00040 
<a name="l00044"></a><a class="code" href="namespaceShapeDotNet.html#a7">00044</a>     <span class="keyword">public</span> <span class="keyword">enum</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a> { <a class="code" href="namespaceShapeDotNet.html#a7a0">Select</a>, <a class="code" href="namespaceShapeDotNet.html#a7a1">Zoom</a>, <a class="code" href="namespaceShapeDotNet.html#a7a2">ZoomArea</a>, <a class="code" href="namespaceShapeDotNet.html#a7a3">Drag</a>, <a class="code" href="namespaceShapeDotNet.html#a7a4">Center</a>, <a class="code" href="namespaceShapeDotNet.html#a7a5">Query</a> };
00045 
00053     [ ToolboxBitmap( typeof( <a class="code" href="classShapeDotNet.html">ShapeDotNet</a>.MapControl ), <span class="stringliteral">"SDN.bmp"</span> ),
00054       Description(<span class="stringliteral">"Shape.Net Map Control"</span>) ] 
<a name="l00055"></a><a class="code" href="classShapeDotNet_1_1MapControl.html">00055</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classShapeDotNet_1_1MapControl.html">MapControl</a> : System.Windows.Forms.UserControl
00056     {   
<a name="l00061"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlo0">00061</a>         <span class="keyword">public</span> event <a class="code" href="namespaceShapeDotNet.html#a6">QueryResultEventHandler</a> <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlo0">OnQueryResult</a>;
00062 
<a name="l00063"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp0">00063</a>         <span class="keyword">protected</span> Brush <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp0">_DragBrush</a>;
<a name="l00064"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp1">00064</a>         <span class="keyword">protected</span> Pen <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp1">_DragPen</a>;
<a name="l00065"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp2">00065</a>         <span class="keyword">protected</span> Graphics <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp2">_Gr</a>;
<a name="l00066"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp3">00066</a>         <span class="keyword">protected</span> Map <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp3">_map</a>;
<a name="l00067"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp4">00067</a>         <span class="keyword">protected</span> <span class="keywordtype">double</span> <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp4">_MouseGeoX</a>;
<a name="l00068"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp5">00068</a>         <span class="keyword">protected</span> <span class="keywordtype">double</span> <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp5">_MouseGeoY</a>;
<a name="l00069"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp6">00069</a>         <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp6">_MouseActionBeginX</a>;
<a name="l00070"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp7">00070</a>         <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp7">_MouseActionBeginY</a>;
<a name="l00071"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp8">00071</a>         <span class="keyword">protected</span> Point <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp8">_MouseActionBeginScreen</a>;
<a name="l00072"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp9">00072</a>         <span class="keyword">protected</span> <span class="keywordtype">bool</span> <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp9">_ButtonDown</a>;
<a name="l00073"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp10">00073</a>         <span class="keyword">protected</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a> <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp10">_PointerMode</a>;
<a name="l00074"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp11">00074</a>         <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp11">_queryLayer</a>;
00075         
00076         <span class="keyword">private</span> System.Windows.Forms.PictureBox Canvas;
00077         <span class="keyword">private</span> System.Windows.Forms.ToolTip queryTip;
00078         <span class="keyword">private</span> System.Windows.Forms.SaveFileDialog saveBitmapDialog;
00079         <span class="keyword">private</span> System.Windows.Forms.OpenFileDialog openFileDialog;
00080         <span class="keyword">private</span> System.ComponentModel.IContainer components;
00081 
<a name="l00082"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControla0">00082</a>         <span class="keyword">public</span> <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControla0">MapControl</a>()
00083         {
00084             <span class="comment">// This call is required by the Windows.Forms Form Designer.</span>
00085             InitializeComponent();
00086 
00087             <span class="comment">// TODO: Add any initialization after the InitForm call</span>
00088             <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp3">_map</a> = <span class="keyword">new</span> Map();
00089             
00090             <span class="keyword">this</span>.ResizeRedraw = <span class="keyword">true</span>;
00091             Canvas.Size = <span class="keyword">this</span>.Size;
00092             
00093             <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp1">_DragPen</a> = <span class="keyword">new</span> Pen( SystemColors.Highlight, 2f );
00094             <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp1">_DragPen</a>.EndCap = LineCap.SquareAnchor;
00095             <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp1">_DragPen</a>.StartCap = LineCap.SquareAnchor;
00096             <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp0">_DragBrush</a> = <span class="keyword">new</span> SolidBrush( Color.FromArgb( 64, SystemColors.Highlight ) );
00097             <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlp11">_queryLayer</a> = -1;
00098         }
00099 
<a name="l00103"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlb0">00103</a>         <span class="keyword">protected</span> override <span class="keywordtype">void</span> <a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControlb0">Dispose</a>( <span class="keywordtype">bool</span> disposing )
00104         {
00105             <span class="keywordflow">if</span>( disposing )
00106             {
00107                 <span class="keywordflow">if</span>( components != null )
00108                     components.Dispose();
00109             }
00110             base.Dispose( disposing );
00111         }
00112 
00113 <span class="preprocessor">        #region Component Designer generated code</span>
00118 <span class="preprocessor">        private void InitializeComponent()</span>
00119 <span class="preprocessor"></span>        {
00120             <span class="keyword">this</span>.components = <span class="keyword">new</span> System.ComponentModel.Container();
00121             <span class="keyword">this</span>.Canvas = <span class="keyword">new</span> System.Windows.Forms.PictureBox();
00122             <span class="keyword">this</span>.queryTip = <span class="keyword">new</span> System.Windows.Forms.ToolTip(<span class="keyword">this</span>.components);
00123             <span class="keyword">this</span>.saveBitmapDialog = <span class="keyword">new</span> System.Windows.Forms.SaveFileDialog();
00124             <span class="keyword">this</span>.openFileDialog = <span class="keyword">new</span> System.Windows.Forms.OpenFileDialog();
00125             <span class="keyword">this</span>.SuspendLayout();
00126             <span class="comment">// </span>
00127             <span class="comment">// Canvas</span>
00128             <span class="comment">// </span>
00129             <span class="keyword">this</span>.Canvas.BackColor = System.Drawing.Color.Transparent;
00130             <span class="keyword">this</span>.Canvas.BorderStyle = System.Windows.Forms.BorderStyle.FixedSingle;
00131             <span class="keyword">this</span>.Canvas.Name = <span class="stringliteral">"Canvas"</span>;
00132             <span class="keyword">this</span>.Canvas.Size = <span class="keyword">new</span> System.Drawing.Size(136, 128);
00133             <span class="keyword">this</span>.Canvas.TabIndex = 0;
00134             <span class="keyword">this</span>.Canvas.TabStop = <span class="keyword">false</span>;
00135             <span class="keyword">this</span>.Canvas.MouseUp += <span class="keyword">new</span> System.Windows.Forms.MouseEventHandler(<span class="keyword">this</span>.Canvas_MouseUp);
00136             <span class="keyword">this</span>.Canvas.MouseMove += <span class="keyword">new</span> System.Windows.Forms.MouseEventHandler(<span class="keyword">this</span>.Canvas_MouseMove);
00137             <span class="keyword">this</span>.Canvas.MouseDown += <span class="keyword">new</span> System.Windows.Forms.MouseEventHandler(<span class="keyword">this</span>.Canvas_MouseDown);
00138             <span class="comment">// </span>
00139             <span class="comment">// queryTip</span>
00140             <span class="comment">// </span>
00141             <span class="keyword">this</span>.queryTip.Active = <span class="keyword">false</span>;
00142             <span class="comment">// </span>
00143             <span class="comment">// saveBitmapDialog</span>
00144             <span class="comment">// </span>
00145             <span class="keyword">this</span>.saveBitmapDialog.FileName = <span class="stringliteral">"map"</span>;
00146             <span class="keyword">this</span>.saveBitmapDialog.Filter = <span class="stringliteral">"Windows Bitmap (*.bmp)|*.bmp|Portable Network Graphics (*.png)|*.png|Graphics Int"</span> +
00147                 <span class="stringliteral">"erchange Format (*.gif)|*.gif|Tagged Image File Format (*.tiff)|*.tiff|Enhanced "</span> +
00148                 <span class="stringliteral">"Windows Metafile (*.emf)|*.emf"</span>;
00149             <span class="keyword">this</span>.saveBitmapDialog.Title = <span class="stringliteral">"Save map to..."</span>;
00150             <span class="comment">// </span>
00151             <span class="comment">// openFileDialog</span>
00152             <span class="comment">// </span>
00153             <span class="keyword">this</span>.openFileDialog.DefaultExt = <span class="stringliteral">"shp"</span>;
00154             <span class="keyword">this</span>.openFileDialog.Filter = <span class="stringliteral">"ESRI Shapefiles (*.shp)|*.shp|All files (*.*)|*.*"</span>;
00155             <span class="keyword">this</span>.openFileDialog.Title = <span class="stringliteral">"Open Shapefile..."</span>;
00156             <span class="comment">// </span>
00157             <span class="comment">// MapControl</span>
00158             <span class="comment">// </span>
00159             <span class="keyword">this</span>.BackColor = System.Drawing.Color.RoyalBlue;
00160             <span class="keyword">this</span>.Controls.AddRange(<span class="keyword">new</span> System.Windows.Forms.Control[] {
00161                                                                           <span class="keyword">this</span>.Canvas});
00162             <span class="keyword">this</span>.Name = <span class="stringliteral">"MapControl"</span>;
00163             <span class="keyword">this</span>.Resize += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.MapControl_Resize);
00164             <span class="keyword">this</span>.Load += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.MapControl_Load);
00165             <span class="keyword">this</span>.ResumeLayout(<span class="keyword">false</span>);
00166 
00167         }
00168 <span class="preprocessor">        #endregion</span>
00169 <span class="preprocessor"></span>
00175         <span class="keyword">private</span> <span class="keywordtype">void</span> MapControl_Load(object sender, System.EventArgs e)
00176         {
00177             Canvas.Size = <span class="keyword">this</span>.Size;
00178         }
00179         
00185         <span class="keyword">private</span> <span class="keywordtype">void</span> MapControl_Resize(object sender, System.EventArgs e)
00186         {
00187             <span class="comment">//The resize event gets fired on minimize.  Logical, but a pain.</span>
00188             <span class="keywordflow">if</span>( <span class="keyword">this</span>.ParentForm != null &amp;&amp; 
00189                 <span class="keyword">this</span>.ParentForm.WindowState != FormWindowState.Minimized )
00190             {
00191                 Canvas.Size = <span class="keyword">this</span>.Size;
00192                 Draw();
00193             }
00194         }
00195 
00203         <span class="keyword">private</span> <span class="keywordtype">void</span> Canvas_MouseDown(object sender, System.Windows.Forms.MouseEventArgs e)
00204         {
00205             <span class="keywordflow">switch</span>( _PointerMode )
00206             {
00207                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Select:
00208                     <span class="keywordflow">break</span>;
00209             
00210                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Zoom:
00211                     <span class="keywordflow">break</span>;
00212 
00213                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.ZoomArea:
00214                     _Gr = Canvas.CreateGraphics();
00215                     _MouseActionBeginScreen = Canvas.PointToScreen( <span class="keyword">new</span> Point( e.X, e.Y ) );
00216                     _MouseActionBeginX = e.X;
00217                     _MouseActionBeginY = e.Y;
00218                     _ButtonDown = <span class="keyword">true</span>;
00219                     <span class="keywordflow">break</span>;
00220             
00221                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Drag:
00222                     _Gr = Canvas.CreateGraphics();
00223                     _MouseActionBeginScreen = Canvas.PointToScreen( <span class="keyword">new</span> Point( e.X, e.Y ) );
00224                     _MouseActionBeginX = e.X;
00225                     _MouseActionBeginY = e.Y;
00226                     _ButtonDown = <span class="keyword">true</span>;
00227                     <span class="keywordflow">break</span>;
00228             
00229                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Center:
00230                     _map.Center( e.X, e.Y );
00231                     Draw();
00232                     <span class="keywordflow">break</span>;
00233 
00234                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Query:
00235                     <span class="keywordflow">break</span>;
00236             }
00237             
00238             OnMouseDown( e );
00239         }
00240 
00248         <span class="keyword">private</span> <span class="keywordtype">void</span> Canvas_MouseMove(object sender, System.Windows.Forms.MouseEventArgs e)
00249         {           
00250             <span class="keywordtype">double</span> tempx = (<span class="keywordtype">double</span>) e.X;
00251             <span class="keywordtype">double</span> tempy = (<span class="keywordtype">double</span>) e.Y;
00252 
00253             _map.Metrics.Pixel2World( ref tempx, ref tempy );
00254             
00255             _MouseGeoX = tempx;
00256             _MouseGeoY = tempy;
00257         
00258             <span class="keywordflow">switch</span>( _PointerMode )
00259             {
00260                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Select:
00261                     <span class="keywordflow">break</span>;
00262         
00263                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Zoom:
00264                     <span class="keywordflow">break</span>;
00265 
00266                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.ZoomArea:
00267                     <span class="keywordflow">if</span> ( _ButtonDown == <span class="keyword">true</span> )
00268                     {   
00269                         Canvas.Refresh();
00270                         
00271                         <span class="keywordtype">int</span> zwidth = Math.Abs( e.X - _MouseActionBeginX );
00272                         <span class="keywordtype">int</span> zheight = Math.Abs( e.Y - _MouseActionBeginY );
00273 
00274                         _Gr.DrawRectangle( _DragPen, _MouseActionBeginX - zwidth, 
00275                             _MouseActionBeginY - zheight, zwidth *2, zheight *2 );
00276 
00277                         _Gr.FillRectangle( _DragBrush, _MouseActionBeginX - zwidth, 
00278                             _MouseActionBeginY - zheight, zwidth *2, zheight *2 );
00279             
00280                         _Gr.DrawRectangle( Pens.White, _MouseActionBeginX - zwidth +1, 
00281                             _MouseActionBeginY - zheight +1, zwidth *2 -2, zheight *2 -2 );
00282                     }
00283                     <span class="keywordflow">break</span>;
00284         
00285                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Drag:
00286                     <span class="keywordflow">if</span> ( _ButtonDown == <span class="keyword">true</span> )
00287                     {
00288                         Canvas.Refresh();
00289                         
00290                         _Gr.DrawLine( <span class="keyword">new</span> Pen( Color.White, 4f ), _MouseActionBeginX, _MouseActionBeginY,
00291                             e.X, e.Y );
00292                         _Gr.DrawEllipse( Pens.White, _MouseActionBeginX -5, _MouseActionBeginY -5,
00293                             10, 10 );
00294                         _Gr.DrawEllipse( Pens.White, e.X -5, e.Y -5,
00295                             10, 10 );
00296 
00297                         _Gr.DrawLine( _DragPen, _MouseActionBeginX, _MouseActionBeginY,
00298                             e.X, e.Y );
00299                         _Gr.FillEllipse( <span class="keyword">new</span> SolidBrush( _DragPen.Color ), _MouseActionBeginX -5, _MouseActionBeginY -5,
00300                             10, 10 );                                   
00301                         _Gr.FillEllipse( <span class="keyword">new</span> SolidBrush( _DragPen.Color ), e.X -5, e.Y -5,
00302                             10, 10 );
00303                     }
00304                     <span class="keywordflow">break</span>;
00305         
00306                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Center:
00307                     <span class="keywordflow">break</span>;
00308 
00309                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Query:
00310                     <span class="keywordflow">break</span>;
00311             }
00312             
00313             OnMouseMove( e );
00314         }
00315         
00323         <span class="keyword">private</span> <span class="keywordtype">void</span> Canvas_MouseUp(object sender, System.Windows.Forms.MouseEventArgs e)
00324         {
00325             _ButtonDown = <span class="keyword">false</span>;
00326             
00327             <span class="keywordflow">switch</span>( _PointerMode )
00328             {
00329                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Select:
00330                     <span class="keywordflow">break</span>;
00331             
00332                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Zoom:                  
00333                     <span class="keywordflow">if</span> ( e.Button == MouseButtons.Left )
00334                     {
00335                         _map.ZoomIn( e.X, e.Y );
00336                         Draw();
00337                     } 
00338                     <span class="keywordflow">else</span> 
00339                     {
00340                         _map.ZoomOut( e.X, e.Y );
00341                         Draw();
00342                     }
00343                     
00344                     <span class="keywordflow">break</span>;
00345             
00346                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.ZoomArea:
00347                     _ButtonDown = <span class="keyword">false</span>;
00348                     <span class="keywordtype">int</span> zwidth = Math.Abs( e.X - _MouseActionBeginX );
00349                     <span class="keywordtype">int</span> zheight = Math.Abs( e.Y - _MouseActionBeginY );
00350                     <span class="keywordtype">int</span> zleft = _MouseActionBeginX - zwidth;
00351                     <span class="keywordtype">int</span> ztop = _MouseActionBeginY - zheight;
00352 
00353                     _map.ZoomArea( zleft, ztop, zleft + (zwidth *2), ztop + (zheight *2) );
00354                     _Gr.Dispose();
00355                     Draw();
00356                     <span class="keywordflow">break</span>;
00357 
00358                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Drag:
00359                     _ButtonDown = <span class="keyword">false</span>;
00360                     _map.Drag( _MouseActionBeginX, _MouseActionBeginY, e.X, e.Y );
00361                     _Gr.Dispose();
00362                     Draw();
00363                     <span class="keywordflow">break</span>;
00364             
00365                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Center:
00366                     <span class="keywordflow">break</span>;
00367             
00368                 <span class="keywordflow">case</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a>.Query:
00369                     <span class="keywordflow">if</span> ( e.Button == MouseButtons.Left )
00370                     {
00371                         <a class="code" href="namespaceShapeDotNet.html#a7a5">Query</a>( e.X, e.Y );
00372                     } 
00373                     <span class="keywordflow">break</span>;
00374             }
00375 
00376             OnMouseUp( e );
00377         }
00378         
<a name="l00382"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControla1">00382</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> Draw()
00383         {
00384             <span class="keyword">this</span>.Cursor = Cursors.WaitCursor;
00385 
00386             <span class="keywordflow">if</span> ( _map.Count &gt; 0 )
00387             {                   
00388                 Bitmap bmp = <span class="keyword">new</span> Bitmap( Canvas.Width, Canvas.Height );             
00389                 
00390                 _map.Draw( bmp );               
00391                 Canvas.Image = bmp;
00392             }
00393             <span class="keywordflow">else</span>
00394             {
00395                 Bitmap bmp = <span class="keyword">new</span> Bitmap( Canvas.Width, Canvas.Height );
00396                 
00397                 Canvas.Image = bmp;
00398                 Canvas.Refresh();
00399             }
00400 
00401             <span class="keyword">this</span>.Cursor = Cursors.Default;
00402         }
00403         
<a name="l00409"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControla2">00409</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> AddLayer()
00410         {
00411             <span class="keywordflow">if</span> ( openFileDialog.ShowDialog() == DialogResult.OK ) 
00412             {               
00413                 <span class="keyword">this</span>.Cursor = Cursors.AppStarting;
00414                 _map.Add( openFileDialog.FileName );
00415                 <span class="keyword">this</span>.Cursor = Cursors.Default;              
00416                 Draw();
00417             }
00418         }
00419 
<a name="l00425"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControla3">00425</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> AddLayer( string filename )
00426         {           
00427             <span class="keyword">this</span>.Cursor = Cursors.AppStarting;
00428             _map.Add( filename );
00429             <span class="keyword">this</span>.Cursor = Cursors.Default;              
00430             Draw();
00431         }
00432 
<a name="l00437"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControla4">00437</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> RemoveLayer( <span class="keywordtype">int</span> index )
00438         {
00439             <span class="keywordflow">if</span> ( index &gt; -1 &amp;&amp; index &lt; _map.Count )
00440             {
00441                 _map.Remove( index );
00442                 Draw();
00443             }
00444         }
00445 
<a name="l00450"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControla5">00450</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> MoveLayerUp( <span class="keywordtype">int</span> index )
00451         {
00452             <span class="keywordflow">if</span> ( _map.Count &gt; 0 &amp;&amp; index != 0 )
00453             {
00454                 IMapLayer tmpLayer = _map[ index ];
00455                 _map.Insert( index - 1, tmpLayer );
00456                 _map.Remove( index + 1 );
00457                 Draw();
00458             }
00459         }
00460 
<a name="l00465"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControla6">00465</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> MoveLayerDown( <span class="keywordtype">int</span> index )
00466         {
00467             <span class="keywordflow">if</span> ( _map.Count &gt; 0 &amp;&amp; index != _map.Count - 1)
00468             {
00469                 IMapLayer tmpLayer = _map[ index ];
00470                 _map.Insert( index + 2, tmpLayer );
00471                 _map.Remove( index );
00472                 Draw();
00473             }
00474         }
00475         
<a name="l00480"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControla7">00480</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> SaveViewToImage()
00481         {
00482             <span class="keywordflow">if</span> ( saveBitmapDialog.ShowDialog() == DialogResult.OK )
00483             {
00484                 Bitmap bmp = <span class="keyword">new</span> Bitmap( <span class="keyword">this</span>.Width, <span class="keyword">this</span>.Height );
00485                 Graphics gr = Graphics.FromImage( bmp );
00486                 gr.FillRectangle( <span class="keyword">new</span> SolidBrush( <span class="keyword">this</span>.BackColor ), 0, 0, <span class="keyword">this</span>.Width, <span class="keyword">this</span>.Height );
00487                 
00488                 _map.Draw( bmp );
00489                 
00490                 <span class="keywordflow">switch</span> ( saveBitmapDialog.FilterIndex )
00491                 {
00492                     <span class="keywordflow">case</span> 1:
00493                         bmp.Save( saveBitmapDialog.FileName, ImageFormat.Bmp );
00494                         <span class="keywordflow">break</span>;
00495                     <span class="keywordflow">case</span> 2:
00496                         bmp.Save( saveBitmapDialog.FileName, ImageFormat.Png );
00497                         <span class="keywordflow">break</span>;
00498                     <span class="keywordflow">case</span> 3:
00499                         bmp.Save( saveBitmapDialog.FileName, ImageFormat.Gif );
00500                         <span class="keywordflow">break</span>;
00501                     <span class="keywordflow">case</span> 4:
00502                         bmp.Save( saveBitmapDialog.FileName, ImageFormat.Tiff );
00503                         <span class="keywordflow">break</span>;
00504                     <span class="keywordflow">case</span> 5:
00505                         bmp.Save( saveBitmapDialog.FileName, ImageFormat.Emf );
00506                         <span class="keywordflow">break</span>;
00507                 }
00508 
00509                 gr.Dispose();
00510             }
00511 
00512         }
00513         
00517         <span class="keyword">public</span> <span class="keywordtype">double</span> MouseGeoX
<a name="l00518"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControl00">00518</a>         {
00519             get
00520             {
00521                 <span class="keywordflow">return</span> _MouseGeoX;
00522             }
00523         }
00524 
00528         <span class="keyword">public</span> <span class="keywordtype">double</span> MouseGeoY
<a name="l00529"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControl01">00529</a>         {
00530             get
00531             {
00532                 <span class="keywordflow">return</span> _MouseGeoY;
00533             }
00534         }
00535         
00540         <span class="keyword">public</span> <a class="code" href="namespaceShapeDotNet.html#a7">PointerMode</a> PointerBehavior
<a name="l00541"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControl02">00541</a>         {
00542             get
00543             {
00544                 <span class="keywordflow">return</span> _PointerMode;
00545             }
00546             set
00547             {
00548                 _PointerMode = value;
00549                 Canvas.Refresh();
00550             }
00551         }
00552 
00556         <span class="keyword">public</span> <span class="keywordtype">int</span> QueryLayer
<a name="l00557"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControl03">00557</a>         {
00558             get
00559             {
00560                 <span class="keywordflow">return</span> _queryLayer;
00561             }
00562             set
00563             {
00564                 _queryLayer = value;
00565             }
00566         }
00567 
00574         <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="namespaceShapeDotNet.html#a7a5">Query</a>( <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
00575         {
00576             <span class="keywordflow">if</span> ( _queryLayer != -1 )
00577             {
00578                 IMapLayer ml = _map[ _queryLayer ];
00579                 string[] result = ml.QueryPoint( x, y );
00580                 <span class="keyword">this</span>.Draw();
00581 
00582                 OnQueryResult( <span class="keyword">this</span>, result );
00583             }
00584         }
00585 
00591         <span class="keyword">public</span> PictureBox MapCanvas
<a name="l00592"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControl04">00592</a>         {
00593             get
00594             {
00595                 <span class="keywordflow">return</span> Canvas;
00596             }
00597         }
00598 
00603         <span class="keyword">public</span> Map MapCollection
<a name="l00604"></a><a class="code" href="classShapeDotNet_1_1MapControl.html#ShapeDotNet_1_1MapControl05">00604</a>         {
00605             get
00606             {
00607                 <span class="keywordflow">return</span> _map;
00608             }
00609         }
00610     }
00611 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Feb 10 17:52:39 2004 for MapControl by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
